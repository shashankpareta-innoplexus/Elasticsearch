/**	Problem 1	**/
For dataset like this:
	object_name : {
		key1 : "value1",
		key2 : "value2"	
	}

We want to first apply queries on first key and then aggregates results on second key.


/** 	Solution	**/

GET index_name/type/_search
{
    "size": 0, 
    "query": {
        "nested": {
           "path": "object_name",
           "query": {
               "match": {
                  "object_name.key1": "value1"
               }
           }
        }
    }, 
    "aggs": {
        "agg_name1": { 
        "nested": {
            "path": "object_name"
            },
        "aggs": {
            "agg_name2": {
            "terms": { 
                "field": "object_name.key2"
                }
        }
      }
    }
  }
}

